<!doctype html>
<html lang="zh-TW">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>太陽系探索者</title>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
        body {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
            color: white;
            overflow: hidden;
            height: 100%;
        }

        html {
            height: 100%;
        }

        .game-container {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .header {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            background: linear-gradient(180deg, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0.4) 70%, transparent 100%);
            padding: 20px;
            text-align: center;
        }

        .game-title {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 0 0 10px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            background: linear-gradient(45deg, #ffd700, #ffed4e, #ffd700);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .welcome-message {
            font-size: 1.2rem;
            margin: 0;
            opacity: 0.9;
        }

        .canvas-container {
            flex: 1;
            position: relative;
            cursor: grab;
        }

        .canvas-container:active {
            cursor: grabbing;
        }

        #space-canvas {
            width: 100%;
            height: 100%;
            display: block;
        }

        .controls-panel {
            position: absolute;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .control-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .control-row:last-child {
            margin-bottom: 0;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .control-button {
            background: linear-gradient(145deg, #2563eb, #1d4ed8);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        .control-button:hover {
            background: linear-gradient(145deg, #1d4ed8, #1e40af);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
        }

        .control-button:active {
            transform: translateY(0);
        }

        .control-button.active {
            background: linear-gradient(145deg, #dc2626, #b91c1c);
        }

        .speed-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .speed-slider {
            width: 120px;
            height: 6px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
        }

        .speed-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            background: #ffd700;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .info-panel {
            position: absolute;
            top: 120px;
            right: 20px;
            width: 280px;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .info-panel.visible {
            transform: translateX(0);
        }

        .info-title {
            font-size: 1.4rem;
            font-weight: bold;
            margin: 0 0 15px 0;
            color: #ffd700;
        }

        .info-item {
            margin-bottom: 10px;
            font-size: 14px;
            line-height: 1.4;
        }

        .info-label {
            font-weight: bold;
            color: #60a5fa;
        }

        .instructions {
            position: absolute;
            top: 120px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 15px;
            padding: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 14px;
            max-width: 250px;
        }

        .planet-button {
            background: linear-gradient(145deg, #7c3aed, #6d28d9);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            margin: 2px;
            transition: all 0.3s ease;
        }

        .planet-button:hover {
            background: linear-gradient(145deg, #6d28d9, #5b21b6);
            transform: scale(1.05);
        }

        .planet-button.selected {
            background: linear-gradient(145deg, #ffd700, #f59e0b);
            color: #000;
        }

        @media (max-width: 768px) {
            .game-title {
                font-size: 2rem;
            }
            
            .controls-panel {
                bottom: 10px;
                left: 10px;
                right: 10px;
                padding: 15px;
            }
            
            .info-panel {
                width: 250px;
                right: 10px;
                top: 100px;
            }
            
            .instructions {
                left: 10px;
                top: 100px;
                max-width: 200px;
            }
            
            .control-row {
                flex-direction: column;
                align-items: stretch;
            }
            
            .control-group {
                justify-content: center;
            }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="game-container">
   <div class="header">
    <h1 class="game-title" id="gameTitle">太陽系探索者</h1>
    <p class="welcome-message" id="welcomeMessage">探索我們的太陽系！</p>
   </div>
   <div class="instructions">
    <div id="controlInstructions">
     拖曳旋轉視角，滾輪縮放
    </div>
    <div style="margin-top: 10px; font-size: 12px; opacity: 0.8;">
     點擊天體查看詳細資訊
    </div>
   </div>
   <div class="canvas-container">
    <canvas id="space-canvas"></canvas>
   </div>
   <div class="info-panel" id="infoPanel">
    <div class="info-title" id="infoTitle">
     選擇一個天體
    </div>
    <div id="infoContent">
     <div class="info-item">
      點擊任何天體來查看詳細資訊和教育內容。
     </div>
    </div>
   </div>
   <div class="controls-panel">
    <div class="control-row">
     <div class="control-group"><button class="control-button" id="playPauseBtn">暫停</button> <button class="control-button" id="resetBtn">重置</button>
     </div>
     <div class="speed-control"><span>時間速度:</span> <input type="range" class="speed-slider" id="speedSlider" min="0" max="5" value="1" step="0.1"> <span id="speedDisplay">1x</span>
     </div>
    </div>
    <div class="control-row">
     <div style="display: flex; flex-wrap: wrap; gap: 5px; justify-content: center;"><button class="planet-button" data-planet="sun">太陽</button> <button class="planet-button" data-planet="earth">地球</button> <button class="planet-button" data-planet="moon">月球</button> <button class="planet-button" data-planet="mars">火星</button> <button class="planet-button" data-planet="jupiter">木星</button>
     </div>
    </div>
   </div>
  </div>
  <script>
        // 預設配置
        const defaultConfig = {
            game_title: "太陽系探索者",
            welcome_message: "探索我們的太陽系！",
            control_instructions: "拖曳旋轉視角，滾輪縮放"
        };

        // 3D 太空遊戲類別
        class SolarSystemExplorer {
            constructor(canvas) {
                this.canvas = canvas;
                this.ctx = canvas.getContext('2d');
                this.width = canvas.width;
                this.height = canvas.height;
                
                // 相機控制
                this.camera = {
                    x: 0,
                    y: 0,
                    zoom: 1,
                    rotation: 0
                };
                
                // 遊戲狀態
                this.isPlaying = true;
                this.timeSpeed = 1;
                this.time = 0;
                this.selectedPlanet = null;
                
                // 滑鼠控制
                this.mouse = {
                    x: 0,
                    y: 0,
                    isDown: false,
                    lastX: 0,
                    lastY: 0
                };
                
                this.initializePlanets();
                this.setupEventListeners();
                this.animate();
            }
            
            initializePlanets() {
                this.planets = {
                    sun: {
                        name: "太陽",
                        x: 0,
                        y: 0,
                        radius: 30,
                        color: "#FDB813",
                        glowColor: "#FFD700",
                        info: {
                            diameter: "1,392,700 公里",
                            mass: "1.989 × 10³⁰ 公斤",
                            temperature: "表面 5,778K",
                            facts: "太陽是太陽系的中心，包含了太陽系99.86%的質量。它是一顆G型主序星，通過核融合產生能量。"
                        }
                    },
                    earth: {
                        name: "地球",
                        x: 0,
                        y: 0,
                        radius: 8,
                        color: "#6B93D6",
                        orbitRadius: 120,
                        orbitSpeed: 0.02,
                        angle: 0,
                        info: {
                            diameter: "12,756 公里",
                            mass: "5.972 × 10²⁴ 公斤",
                            distance: "距太陽 1.496 億公里",
                            facts: "地球是太陽系中唯一已知有生命的行星。它有一個天然衛星（月球）和保護性的磁場。"
                        }
                    },
                    moon: {
                        name: "月球",
                        x: 0,
                        y: 0,
                        radius: 3,
                        color: "#C0C0C0",
                        orbitRadius: 20,
                        orbitSpeed: 0.1,
                        angle: 0,
                        parent: 'earth',
                        info: {
                            diameter: "3,475 公里",
                            mass: "7.342 × 10²² 公斤",
                            distance: "距地球 384,400 公里",
                            facts: "月球是地球的天然衛星，影響地球的潮汐。它的重力約為地球的1/6。"
                        }
                    },
                    mars: {
                        name: "火星",
                        x: 0,
                        y: 0,
                        radius: 6,
                        color: "#CD5C5C",
                        orbitRadius: 180,
                        orbitSpeed: 0.015,
                        angle: Math.PI,
                        info: {
                            diameter: "6,792 公里",
                            mass: "6.39 × 10²³ 公斤",
                            distance: "距太陽 2.279 億公里",
                            facts: "火星被稱為紅色星球，因為其表面富含氧化鐵。它有兩個小衛星：火衛一和火衛二。"
                        }
                    },
                    jupiter: {
                        name: "木星",
                        x: 0,
                        y: 0,
                        radius: 20,
                        color: "#D8CA9D",
                        orbitRadius: 280,
                        orbitSpeed: 0.008,
                        angle: Math.PI * 0.5,
                        info: {
                            diameter: "142,984 公里",
                            mass: "1.898 × 10²⁷ 公斤",
                            distance: "距太陽 7.786 億公里",
                            facts: "木星是太陽系最大的行星，質量超過其他所有行星的總和。它有超過80個已知衛星。"
                        }
                    }
                };
            }
            
            setupEventListeners() {
                // 滑鼠事件
                this.canvas.addEventListener('mousedown', (e) => {
                    this.mouse.isDown = true;
                    this.mouse.lastX = e.clientX;
                    this.mouse.lastY = e.clientY;
                });
                
                this.canvas.addEventListener('mousemove', (e) => {
                    if (this.mouse.isDown) {
                        const deltaX = e.clientX - this.mouse.lastX;
                        const deltaY = e.clientY - this.mouse.lastY;
                        
                        this.camera.x += deltaX;
                        this.camera.y += deltaY;
                        
                        this.mouse.lastX = e.clientX;
                        this.mouse.lastY = e.clientY;
                    }
                });
                
                this.canvas.addEventListener('mouseup', () => {
                    this.mouse.isDown = false;
                });
                
                this.canvas.addEventListener('click', (e) => {
                    if (!this.mouse.isDown) {
                        this.handlePlanetClick(e);
                    }
                });
                
                // 滾輪縮放
                this.canvas.addEventListener('wheel', (e) => {
                    e.preventDefault();
                    const zoomFactor = e.deltaY > 0 ? 0.9 : 1.1;
                    this.camera.zoom = Math.max(0.3, Math.min(3, this.camera.zoom * zoomFactor));
                });
                
                // 觸控支援
                this.canvas.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    const touch = e.touches[0];
                    this.mouse.isDown = true;
                    this.mouse.lastX = touch.clientX;
                    this.mouse.lastY = touch.clientY;
                });
                
                this.canvas.addEventListener('touchmove', (e) => {
                    e.preventDefault();
                    if (this.mouse.isDown && e.touches.length === 1) {
                        const touch = e.touches[0];
                        const deltaX = touch.clientX - this.mouse.lastX;
                        const deltaY = touch.clientY - this.mouse.lastY;
                        
                        this.camera.x += deltaX;
                        this.camera.y += deltaY;
                        
                        this.mouse.lastX = touch.clientX;
                        this.mouse.lastY = touch.clientY;
                    }
                });
                
                this.canvas.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    this.mouse.isDown = false;
                });
            }
            
            handlePlanetClick(e) {
                const rect = this.canvas.getBoundingClientRect();
                const clickX = e.clientX - rect.left;
                const clickY = e.clientY - rect.top;
                
                // 轉換到世界座標
                const worldX = (clickX - this.width/2 - this.camera.x) / this.camera.zoom;
                const worldY = (clickY - this.height/2 - this.camera.y) / this.camera.zoom;
                
                // 檢查點擊的天體
                for (const [key, planet] of Object.entries(this.planets)) {
                    const distance = Math.sqrt((worldX - planet.x) ** 2 + (worldY - planet.y) ** 2);
                    if (distance <= planet.radius) {
                        this.selectPlanet(key);
                        break;
                    }
                }
            }
            
            selectPlanet(planetKey) {
                this.selectedPlanet = planetKey;
                const planet = this.planets[planetKey];
                
                // 更新資訊面板
                const infoPanel = document.getElementById('infoPanel');
                const infoTitle = document.getElementById('infoTitle');
                const infoContent = document.getElementById('infoContent');
                
                infoTitle.textContent = planet.name;
                infoContent.innerHTML = `
                    <div class="info-item">
                        <span class="info-label">直徑:</span> ${planet.info.diameter}
                    </div>
                    <div class="info-item">
                        <span class="info-label">質量:</span> ${planet.info.mass}
                    </div>
                    <div class="info-item">
                        <span class="info-label">${planet.info.distance ? '距離:' : '溫度:'}</span> 
                        ${planet.info.distance || planet.info.temperature}
                    </div>
                    <div class="info-item" style="margin-top: 15px; font-size: 13px; line-height: 1.5;">
                        ${planet.info.facts}
                    </div>
                `;
                
                infoPanel.classList.add('visible');
                
                // 更新按鈕狀態
                document.querySelectorAll('.planet-button').forEach(btn => {
                    btn.classList.remove('selected');
                });
                document.querySelector(`[data-planet="${planetKey}"]`).classList.add('selected');
            }
            
            updatePlanets() {
                if (!this.isPlaying) return;
                
                this.time += this.timeSpeed;
                
                // 更新行星位置
                for (const [key, planet] of Object.entries(this.planets)) {
                    if (planet.orbitRadius) {
                        if (planet.parent) {
                            // 衛星繞行星運行
                            const parent = this.planets[planet.parent];
                            planet.angle += planet.orbitSpeed * this.timeSpeed;
                            planet.x = parent.x + Math.cos(planet.angle) * planet.orbitRadius;
                            planet.y = parent.y + Math.sin(planet.angle) * planet.orbitRadius;
                        } else {
                            // 行星繞太陽運行
                            planet.angle += planet.orbitSpeed * this.timeSpeed;
                            planet.x = Math.cos(planet.angle) * planet.orbitRadius;
                            planet.y = Math.sin(planet.angle) * planet.orbitRadius;
                        }
                    }
                }
            }
            
            render() {
                // 清除畫布
                this.ctx.fillStyle = '#000011';
                this.ctx.fillRect(0, 0, this.width, this.height);
                
                // 繪製星星背景
                this.drawStars();
                
                // 設定變換
                this.ctx.save();
                this.ctx.translate(this.width/2 + this.camera.x, this.height/2 + this.camera.y);
                this.ctx.scale(this.camera.zoom, this.camera.zoom);
                
                // 繪製軌道
                this.drawOrbits();
                
                // 繪製天體
                this.drawPlanets();
                
                this.ctx.restore();
            }
            
            drawStars() {
                this.ctx.fillStyle = 'white';
                for (let i = 0; i < 200; i++) {
                    const x = (i * 37) % this.width;
                    const y = (i * 73) % this.height;
                    const size = Math.random() * 2;
                    this.ctx.fillRect(x, y, size, size);
                }
            }
            
            drawOrbits() {
                this.ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
                this.ctx.lineWidth = 1;
                
                for (const planet of Object.values(this.planets)) {
                    if (planet.orbitRadius && !planet.parent) {
                        this.ctx.beginPath();
                        this.ctx.arc(0, 0, planet.orbitRadius, 0, Math.PI * 2);
                        this.ctx.stroke();
                    }
                }
            }
            
            drawPlanets() {
                for (const [key, planet] of Object.entries(this.planets)) {
                    this.ctx.save();
                    
                    // 移動到行星位置
                    this.ctx.translate(planet.x, planet.y);
                    
                    // 繪製光暈（太陽）
                    if (planet.glowColor) {
                        const gradient = this.ctx.createRadialGradient(0, 0, 0, 0, 0, planet.radius * 2);
                        gradient.addColorStop(0, planet.glowColor + '80');
                        gradient.addColorStop(0.5, planet.glowColor + '40');
                        gradient.addColorStop(1, 'transparent');
                        
                        this.ctx.fillStyle = gradient;
                        this.ctx.beginPath();
                        this.ctx.arc(0, 0, planet.radius * 2, 0, Math.PI * 2);
                        this.ctx.fill();
                    }
                    
                    // 繪製行星
                    this.ctx.fillStyle = planet.color;
                    this.ctx.beginPath();
                    this.ctx.arc(0, 0, planet.radius, 0, Math.PI * 2);
                    this.ctx.fill();
                    
                    // 選中效果
                    if (this.selectedPlanet === key) {
                        this.ctx.strokeStyle = '#FFD700';
                        this.ctx.lineWidth = 3;
                        this.ctx.beginPath();
                        this.ctx.arc(0, 0, planet.radius + 5, 0, Math.PI * 2);
                        this.ctx.stroke();
                    }
                    
                    // 繪製標籤
                    this.ctx.fillStyle = 'white';
                    this.ctx.font = '12px Microsoft JhengHei';
                    this.ctx.textAlign = 'center';
                    this.ctx.fillText(planet.name, 0, planet.radius + 20);
                    
                    this.ctx.restore();
                }
            }
            
            animate() {
                this.updatePlanets();
                this.render();
                requestAnimationFrame(() => this.animate());
            }
            
            resize() {
                this.width = this.canvas.width = this.canvas.offsetWidth;
                this.height = this.canvas.height = this.canvas.offsetHeight;
            }
            
            togglePlayPause() {
                this.isPlaying = !this.isPlaying;
                return this.isPlaying;
            }
            
            reset() {
                this.time = 0;
                this.camera = { x: 0, y: 0, zoom: 1, rotation: 0 };
                this.selectedPlanet = null;
                
                // 重置行星位置
                this.planets.earth.angle = 0;
                this.planets.mars.angle = Math.PI;
                this.planets.jupiter.angle = Math.PI * 0.5;
                this.planets.moon.angle = 0;
                
                // 隱藏資訊面板
                document.getElementById('infoPanel').classList.remove('visible');
                
                // 重置按鈕狀態
                document.querySelectorAll('.planet-button').forEach(btn => {
                    btn.classList.remove('selected');
                });
            }
            
            setTimeSpeed(speed) {
                this.timeSpeed = speed;
            }
        }

        // 初始化遊戲
        let game;
        
        function initGame() {
            const canvas = document.getElementById('space-canvas');
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            
            game = new SolarSystemExplorer(canvas);
            
            // 視窗大小調整
            window.addEventListener('resize', () => {
                game.resize();
            });
        }

        // 控制事件
        document.addEventListener('DOMContentLoaded', () => {
            initGame();
            
            // 播放/暫停按鈕
            const playPauseBtn = document.getElementById('playPauseBtn');
            playPauseBtn.addEventListener('click', () => {
                const isPlaying = game.togglePlayPause();
                playPauseBtn.textContent = isPlaying ? '暫停' : '播放';
            });
            
            // 重置按鈕
            document.getElementById('resetBtn').addEventListener('click', () => {
                game.reset();
                playPauseBtn.textContent = '暫停';
                document.getElementById('speedSlider').value = 1;
                document.getElementById('speedDisplay').textContent = '1x';
            });
            
            // 速度滑桿
            const speedSlider = document.getElementById('speedSlider');
            const speedDisplay = document.getElementById('speedDisplay');
            
            speedSlider.addEventListener('input', (e) => {
                const speed = parseFloat(e.target.value);
                game.setTimeSpeed(speed);
                speedDisplay.textContent = speed.toFixed(1) + 'x';
            });
            
            // 行星按鈕
            document.querySelectorAll('.planet-button').forEach(btn => {
                btn.addEventListener('click', () => {
                    const planetKey = btn.dataset.planet;
                    game.selectPlanet(planetKey);
                });
            });
        });

        // Element SDK 配置
        const elementConfig = {
            defaultConfig: defaultConfig,
            onConfigChange: async (config) => {
                const gameTitle = document.getElementById('gameTitle');
                const welcomeMessage = document.getElementById('welcomeMessage');
                const controlInstructions = document.getElementById('controlInstructions');
                
                if (gameTitle) {
                    gameTitle.textContent = config.game_title || defaultConfig.game_title;
                }
                if (welcomeMessage) {
                    welcomeMessage.textContent = config.welcome_message || defaultConfig.welcome_message;
                }
                if (controlInstructions) {
                    controlInstructions.textContent = config.control_instructions || defaultConfig.control_instructions;
                }
            },
            mapToCapabilities: (config) => ({
                recolorables: [],
                borderables: [],
                fontEditable: undefined,
                fontSizeable: undefined
            }),
            mapToEditPanelValues: (config) => new Map([
                ["game_title", config.game_title || defaultConfig.game_title],
                ["welcome_message", config.welcome_message || defaultConfig.welcome_message],
                ["control_instructions", config.control_instructions || defaultConfig.control_instructions]
            ])
        };

        // 初始化 Element SDK
        if (window.elementSdk) {
            window.elementSdk.init(elementConfig);
        }
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99913c2f2050841c',t:'MTc2MjIyOTE0OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>